/**
 * Combined by jsDelivr.
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/@ckeditor/ckeditor5-code-block@23.1.0/src/codeblock.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
import Plugin from"@ckeditor/ckeditor5-core/src/plugin";import CodeBlockEditing from"./codeblockediting";import CodeBlockUI from"./codeblockui";export default class CodeBlock extends Plugin{static get requires(){return[CodeBlockEditing,CodeBlockUI]}static get pluginName(){return"CodeBlock"}}
;

/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/@ckeditor/ckeditor5-code-block@23.1.0/src/codeblockcommand.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
import Command from"@ckeditor/ckeditor5-core/src/command";import first from"@ckeditor/ckeditor5-utils/src/first";import{getNormalizedAndLocalizedLanguageDefinitions}from"./utils";export default class CodeBlockCommand extends Command{refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const o=this.editor,t=o.model,r=t.document.selection,i=getNormalizedAndLocalizedLanguageDefinitions(o)[0],c=Array.from(r.getSelectedBlocks()),n=void 0===e.forceValue?!this.value:e.forceValue,a=e.language||i.language;t.change((e=>{n?this._applyCodeBlock(e,c,a):this._removeCodeBlock(e,c)}))}_getValue(){const e=this.editor.model.document.selection,o=first(e.getSelectedBlocks());return!!!(!o||!o.is("element","codeBlock"))&&o.getAttribute("language")}_checkEnabled(){if(this.value)return!0;const e=this.editor.model.document.selection,o=this.editor.model.schema,t=first(e.getSelectedBlocks());return!!t&&canBeCodeBlock(o,t)}_applyCodeBlock(e,o,t){const r=this.editor.model.schema,i=o.filter((e=>canBeCodeBlock(r,e)));for(const o of i)e.rename(o,"codeBlock"),e.setAttribute("language",t,o),r.removeDisallowedAttributes([o],e);i.reverse().forEach(((o,t)=>{const r=i[t+1];o.previousSibling===r&&(e.appendElement("softBreak",r),e.merge(e.createPositionBefore(o)))}))}_removeCodeBlock(e,o){const t=o.filter((e=>e.is("element","codeBlock")));for(const o of t){const t=e.createRangeOn(o);for(const o of Array.from(t.getItems()).reverse())if(o.is("element","softBreak")&&o.parent.is("element","codeBlock")){const{position:t}=e.split(e.createPositionBefore(o));e.rename(t.nodeAfter,"paragraph"),e.removeAttribute("language",t.nodeAfter),e.remove(o)}e.rename(o,"paragraph"),e.removeAttribute("language",o)}}}function canBeCodeBlock(e,o){return!o.is("rootElement")&&!e.isLimit(o)&&e.checkChild(o.parent,"codeBlock")}
;

/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/@ckeditor/ckeditor5-code-block@23.1.0/src/codeblockediting.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
import Plugin from"@ckeditor/ckeditor5-core/src/plugin";import ShiftEnter from"@ckeditor/ckeditor5-enter/src/shiftenter";import CodeBlockCommand from"./codeblockcommand";import IndentCodeBlockCommand from"./indentcodeblockcommand";import OutdentCodeBlockCommand from"./outdentcodeblockcommand";import{getNormalizedAndLocalizedLanguageDefinitions,getLeadingWhiteSpaces,rawSnippetTextToModelDocumentFragment}from"./utils";import{modelToViewCodeBlockInsertion,modelToDataViewSoftBreakInsertion,dataViewToModelCodeBlockInsertion}from"./converters";const DEFAULT_ELEMENT="paragraph";export default class CodeBlockEditing extends Plugin{static get pluginName(){return"CodeBlockEditing"}static get requires(){return[ShiftEnter]}constructor(e){super(e),e.config.define("codeBlock",{languages:[{language:"plaintext",label:"Plain text"},{language:"c",label:"C"},{language:"cs",label:"C#"},{language:"cpp",label:"C++"},{language:"css",label:"CSS"},{language:"diff",label:"Diff"},{language:"html",label:"HTML"},{language:"java",label:"Java"},{language:"javascript",label:"JavaScript"},{language:"php",label:"PHP"},{language:"python",label:"Python"},{language:"ruby",label:"Ruby"},{language:"typescript",label:"TypeScript"},{language:"xml",label:"XML"}],indentSequence:"\t"})}init(){const e=this.editor,t=e.model.schema,o=e.model,n=getNormalizedAndLocalizedLanguageDefinitions(e);e.commands.add("codeBlock",new CodeBlockCommand(e)),e.commands.add("indentCodeBlock",new IndentCodeBlockCommand(e)),e.commands.add("outdentCodeBlock",new OutdentCodeBlockCommand(e));const a=e=>(t,o)=>{this.editor.commands.get(e).isEnabled&&(this.editor.execute(e),o())};e.keystrokes.set("Tab",a("indentCodeBlock")),e.keystrokes.set("Shift+Tab",a("outdentCodeBlock")),t.register("codeBlock",{allowWhere:"$block",isBlock:!0,allowAttributes:["language"]}),t.extend("$text",{allowIn:"codeBlock"}),t.addAttributeCheck((e=>{if(e.endsWith("codeBlock $text"))return!1})),e.editing.downcastDispatcher.on("insert:codeBlock",modelToViewCodeBlockInsertion(o,n,!0)),e.data.downcastDispatcher.on("insert:codeBlock",modelToViewCodeBlockInsertion(o,n)),e.data.downcastDispatcher.on("insert:softBreak",modelToDataViewSoftBreakInsertion(o),{priority:"high"}),e.data.upcastDispatcher.on("element:pre",dataViewToModelCodeBlockInsertion(e.editing.view,n)),this.listenTo(e.editing.view.document,"clipboardInput",((e,t)=>{const n=o.document.selection;if(!n.anchor.parent.is("element","codeBlock"))return;const a=t.dataTransfer.getData("text/plain");o.change((t=>{o.insertContent(rawSnippetTextToModelDocumentFragment(t,a),n),e.stop()}))})),this.listenTo(o,"getSelectedContent",((e,[n])=>{const a=n.anchor;!n.isCollapsed&&a.parent.is("element","codeBlock")&&a.hasSameParentAs(n.focus)&&o.change((o=>{const i=e.return;if(i.childCount>1||n.containsEntireContent(a.parent)){const t=o.createElement("codeBlock",a.parent.getAttributes());o.append(i,t);const n=o.createDocumentFragment();o.append(t,n),e.return=n}else{const e=i.getChild(0);t.checkAttribute(e,"code")&&o.setAttribute("code",!0,e)}}))}))}afterInit(){const e=this.editor,t=e.commands,o=t.get("indent"),n=t.get("outdent");o&&o.registerChildCommand(t.get("indentCodeBlock")),n&&n.registerChildCommand(t.get("outdentCodeBlock")),this.listenTo(e.editing.view.document,"enter",((t,o)=>{e.model.document.selection.getLastPosition().parent.is("element","codeBlock")&&(leaveBlockStartOnEnter(e,o.isSoft)||leaveBlockEndOnEnter(e,o.isSoft)||breakLineOnEnter(e),o.preventDefault(),t.stop())}))}}function breakLineOnEnter(e){const t=e.model.document,o=t.selection.getLastPosition(),n=o.nodeBefore||o.textNode;let a;n&&n.is("$text")&&(a=getLeadingWhiteSpaces(n)),e.model.change((o=>{e.execute("shiftEnter"),a&&o.insertText(a,t.selection.anchor)}))}function leaveBlockStartOnEnter(e,t){const o=e.model.document,n=e.editing.view,a=o.selection.getLastPosition(),i=a.nodeAfter;return!(t||!o.selection.isCollapsed||!a.isAtStart)&&(!(!i||!i.is("element","softBreak"))&&(e.model.change((t=>{e.execute("enter");const n=o.selection.anchor.parent.previousSibling;t.rename(n,"paragraph"),t.setSelection(n,"in"),e.model.schema.removeDisallowedAttributes([n],t),t.remove(i)})),n.scrollToTheSelection(),!0))}function leaveBlockEndOnEnter(e,t){const o=e.model,n=o.document,a=e.editing.view,i=n.selection.getLastPosition(),l=i.nodeBefore;let c;if(t||!n.selection.isCollapsed||!i.isAtEnd||!l)return!1;if(l.is("element","softBreak"))c=o.createRangeOn(l);else{if(!l.is("$text")||l.data.match(/\S/)||!l.previousSibling||!l.previousSibling.is("element","softBreak"))return!1;c=o.createRange(o.createPositionBefore(l.previousSibling),o.createPositionAfter(l))}return e.model.change((t=>{t.remove(c),e.execute("enter");const o=n.selection.anchor.parent;t.rename(o,"paragraph"),e.model.schema.removeDisallowedAttributes([o],t)})),a.scrollToTheSelection(),!0}
;

/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/@ckeditor/ckeditor5-code-block@23.1.0/src/codeblockui.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
import Plugin from"@ckeditor/ckeditor5-core/src/plugin";import Collection from"@ckeditor/ckeditor5-utils/src/collection";import Model from"@ckeditor/ckeditor5-ui/src/model";import SplitButtonView from"@ckeditor/ckeditor5-ui/src/dropdown/button/splitbuttonview";import{createDropdown,addListToDropdown}from"@ckeditor/ckeditor5-ui/src/dropdown/utils";import{getNormalizedAndLocalizedLanguageDefinitions}from"./utils";import codeBlockIcon from"../theme/icons/codeblock.svg";import"../theme/codeblock.css";export default class CodeBlockUI extends Plugin{init(){const o=this.editor,e=o.t,t=o.ui.componentFactory,i=getNormalizedAndLocalizedLanguageDefinitions(o),c=i[0];t.add("codeBlock",(t=>{const n=o.commands.get("codeBlock"),d=createDropdown(t,SplitButtonView),l=d.buttonView;return l.set({label:e("Insert code block"),tooltip:!0,icon:codeBlockIcon,isToggleable:!0}),l.bind("isOn").to(n,"value",(o=>!!o)),l.on("execute",(()=>{o.execute("codeBlock",{language:c.language}),o.editing.view.focus()})),d.on("execute",(e=>{o.execute("codeBlock",{language:e.source._codeBlockLanguage,forceValue:!0}),o.editing.view.focus()})),d.class="ck-code-block-dropdown",d.bind("isEnabled").to(n),addListToDropdown(d,this._getLanguageListItemDefinitions(i)),d}))}_getLanguageListItemDefinitions(o){const e=this.editor.commands.get("codeBlock"),t=new Collection;for(const i of o){const o={type:"button",model:new Model({_codeBlockLanguage:i.language,label:i.label,withText:!0})};o.model.bind("isOn").to(e,"value",(e=>e===o.model._codeBlockLanguage)),t.add(o)}return t}}
;

/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/@ckeditor/ckeditor5-code-block@23.1.0/src/converters.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
import{rawSnippetTextToModelDocumentFragment,getPropertyAssociation}from"./utils";export function modelToViewCodeBlockInsertion(e,t,n=!1){const o=getPropertyAssociation(t,"language","class"),r=getPropertyAssociation(t,"language","label");return(t,a,i)=>{const{writer:s,mapper:c,consumable:l}=i;if(!l.consume(a.item,"insert"))return;const m=a.item.getAttribute("language"),u=c.toViewPosition(e.createPositionBefore(a.item)),g={};n&&(g["data-language"]=r[m],g.spellcheck="false");const p=s.createContainerElement("pre",g),d=s.createContainerElement("code",{class:o[m]||null});s.insert(s.createPositionAt(p,0),d),s.insert(u,p),c.bindElements(a.item,d)}}export function modelToDataViewSoftBreakInsertion(e){return(t,n,o)=>{if("codeBlock"!==n.item.parent.name)return;const{writer:r,mapper:a,consumable:i}=o;if(!i.consume(n.item,"insert"))return;const s=a.toViewPosition(e.createPositionBefore(n.item));r.insert(s,r.createText("\n"))}}export function dataViewToModelCodeBlockInsertion(e,t){const n=getPropertyAssociation(t,"class","language"),o=t[0].language;return(t,r,a)=>{const i=r.viewItem,s=i.getChild(0);if(!s||!s.is("element","code"))return;const{consumable:c,writer:l}=a;if(!c.test(i,{name:!0})||!c.test(s,{name:!0}))return;const m=l.createElement("codeBlock"),u=[...s.getClassNames()];u.length||u.push("");for(const e of u){const t=n[e];if(t){l.setAttribute("language",t,m);break}}m.hasAttribute("language")||l.setAttribute("language",o,m);const g=[...e.createRangeIn(s)].filter((e=>"text"===e.type)).map((({item:e})=>e.data)).join(""),p=rawSnippetTextToModelDocumentFragment(l,g);l.append(p,m),a.safeInsert(m,r.modelCursor)&&(c.consume(i,{name:!0}),c.consume(s,{name:!0}),a.updateConversionResult(m,r))}}
;

/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/@ckeditor/ckeditor5-code-block@23.1.0/src/indentcodeblockcommand.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
import Command from"@ckeditor/ckeditor5-core/src/command";import{getIndentOutdentPositions,isModelSelectionInCodeBlock}from"./utils";export default class IndentCodeBlockCommand extends Command{constructor(e){super(e),this._indentSequence=e.config.get("codeBlock.indentSequence")}refresh(){this.isEnabled=this._checkEnabled()}execute(){const e=this.editor.model;e.change((t=>{const n=getIndentOutdentPositions(e);for(const e of n)t.insertText(this._indentSequence,e)}))}_checkEnabled(){return!!this._indentSequence&&isModelSelectionInCodeBlock(this.editor.model.document.selection)}}
;

/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/@ckeditor/ckeditor5-code-block@23.1.0/src/outdentcodeblockcommand.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
import Command from"@ckeditor/ckeditor5-core/src/command";import{getLeadingWhiteSpaces,getIndentOutdentPositions,isModelSelectionInCodeBlock}from"./utils";export default class OutdentCodeBlockCommand extends Command{constructor(e){super(e),this._indentSequence=e.config.get("codeBlock.indentSequence")}refresh(){this.isEnabled=this._checkEnabled()}execute(){const e=this.editor.model;e.change((t=>{const n=getIndentOutdentPositions(e);for(const e of n){const n=getLastOutdentableSequenceRange(this.editor.model,e,this._indentSequence);n&&t.remove(n)}}))}_checkEnabled(){if(!this._indentSequence)return!1;const e=this.editor.model;return!!isModelSelectionInCodeBlock(e.document.selection)&&getIndentOutdentPositions(e).some((t=>getLastOutdentableSequenceRange(e,t,this._indentSequence)))}}function getLastOutdentableSequenceRange(e,t,n){const o=getCodeLineTextNodeAtPosition(t);if(!o)return null;const i=getLeadingWhiteSpaces(o),s=i.lastIndexOf(n);if(s+n.length!==i.length)return null;if(-1===s)return null;const{parent:d,startOffset:c}=o;return e.createRange(e.createPositionAt(d,c+s),e.createPositionAt(d,c+s+n.length))}function getCodeLineTextNodeAtPosition(e){let t=e.parent.getChild(e.index);return t&&!t.is("element","softBreak")||(t=e.nodeBefore),!t||t.is("element","softBreak")?null:t}
;

/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/@ckeditor/ckeditor5-code-block@23.1.0/src/utils.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
import first from"@ckeditor/ckeditor5-utils/src/first";export function getNormalizedAndLocalizedLanguageDefinitions(e){const t=e.t,n=e.config.get("codeBlock.languages");for(const e of n)"Plain text"===e.label&&(e.label=t("Plain text")),void 0===e.class&&(e.class="language-"+e.language);return n}export function getPropertyAssociation(e,t,n){const o={};for(const i of e)"class"===t?o[i[t].split(" ").shift()]=i[n]:o[i[t]]=i[n];return o}export function getLeadingWhiteSpaces(e){return e.data.match(/^(\s*)/)[0]}export function rawSnippetTextToModelDocumentFragment(e,t){const n=e.createDocumentFragment(),o=t.split("\n").map((t=>e.createText(t))),i=o[o.length-1];for(const t of o)e.append(t,n),t!==i&&e.appendElement("softBreak",n);return n}export function getIndentOutdentPositions(e){const t=e.document.selection,n=[];if(t.isCollapsed)n.push(t.anchor);else{const o=t.getFirstRange().getWalker({ignoreElementEnd:!0,direction:"backward"});for(const{item:t}of o)if(t.is("$textProxy")&&t.parent.is("element","codeBlock")){const o=getLeadingWhiteSpaces(t.textNode),{parent:i,startOffset:r}=t.textNode,s=e.createPositionAt(i,r+o.length);n.push(s)}}return n}export function isModelSelectionInCodeBlock(e){const t=first(e.getSelectedBlocks());return t&&t.is("element","codeBlock")}
//# sourceMappingURL=/sm/d005e4be5270a95d76a83de6befdcd3b955331f39a31ec655ce4f2bfe70176be.map